{*notag*}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Memeja: 2 Me's; 1 Meme</title>
{assign var=appid value=$util->get_values_from_config('FACEBOOK')}
{assign var=chc value=$smarty.request.choice}

<script type="text/javascript" src="##JS_PATH##libsext/jquery/jquery.js"></script>

<!-- JQuery Library for New Fancybox -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script type="text/javascript" src="##JS_PATH##libsext/fancybox/jquery.mousewheel-3.0.6.pack.js"></script>

<!-- Add fancyBox -->
<link rel="stylesheet" href="##LBL_SITE_URL##templates/css_theme/fancybox/jquery.fancybox.css?v=2.0.4" type="text/css" media="screen" />
<script type="text/javascript" src="##JS_PATH##libsext/fancybox/jquery.fancybox.pack.js?v=2.0.4"></script>

<!-- Optionally add button and/or thumbnail helpers -->
<link rel="stylesheet" href="##LBL_SITE_URL##templates/css_theme/fancybox/jquery.fancybox-buttons.css?v=2.0.4" type="text/css" media="screen" />
<script type="text/javascript" src="##JS_PATH##libsext/fancybox/jquery.fancybox-buttons.js?v=2.0.4"></script>
<link rel="stylesheet" href="##LBL_SITE_URL##templates/css_theme/fancybox/jquery.fancybox-thumbs.css?v=2.0.4" type="text/css" media="screen" />
<script type="text/javascript" src="##JS_PATH##libsext/fancybox/jquery.fancybox-thumbs.js?v=2.0.4"></script>

<script type="text/javascript" src="##LBL_SITE_URL##templates/flexyjs/flexymessage.js"></script>
<script type="text/javascript" src="##JS_PATH##libsext/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="##JS_PATH##libsext/js/ui.datepicker.js"></script>

<script type="text/javascript" src="##JS_PATH##libsext/js/ajaxfileupload.js"></script>

<script type="text/javascript" src="##JS_PATH##libsext/hotkeys/jquery.hotkeys.js"></script>

<!-- Hover Intent -->
<script type="text/javascript" src="##LBL_SITE_URL##libsext/hoverintent/jquery.hoverIntent.js"></script>

<!-- XP Bar CSS + JS-->
<link rel="stylesheet" type="text/css" href="##LBL_SITE_URL##templates/css_theme/jquery-ui-1.8.16.custom.css"/>
<script type="text/javascript" src="##JS_PATH##libsext/xpbar/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="##JS_PATH##libsext/xpbar/jquery.effects.core.js"></script>
<script type="text/javascript" src="##JS_PATH##libsext/xpbar/jquery.effects.highlight.js"></script>

<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>

<link rel="stylesheet" type="text/css" href="##LBL_SITE_URL##templates/css_theme/mainpg.css"/>
{literal}

<script type="text/javascript">
	var chc ="{/literal}{$chc}{literal}";
	var idu="{/literal}{$smarty.session.id_user}{literal}";
	
		// Variables for XP updating
		var curr_xp = {/literal}{if $smarty.session.exp_point}{$smarty.session.exp_point}{else}0{/if}{literal};
		var xp_to_level = {/literal}{if $smarty.session.xp_to_level}{$smarty.session.xp_to_level}{else}0{/if}{literal};
		var previous_xp_to_level = {/literal}{if $smarty.session.previous_xp_to_level}{$smarty.session.previous_xp_to_level}{else}0{/if}{literal};

		var user_level = {/literal}{if $smarty.session.level}{$smarty.session.level}{else}0{/if}{literal};

		if (user_level == 1) {
			var xp_percent = (curr_xp / xp_to_level) * 100;
		} else {
			{/literal}{if $smarty.session.exp_point}
				xp_percent = (curr_xp - previous_xp_to_level) / (xp_to_level - previous_xp_to_level) * 100;
			{else}xp_percent = 0{/if}{literal}
		}
	
$(document).ready(function(){console.log("User level is "+user_level);console.log("Total XP is "+curr_xp);console.log("XP needed to level is "+xp_to_level);console.log("XP Percent displayed is "+xp_percent);console.log("Previous XP To level is "+previous_xp_to_level);$("#xpbar").progressbar({value:xp_percent});$("#user_level").html("L"+user_level);$("#xpbar_status").html("("+xp_percent.toFixed(2)+"%) "+(curr_xp-previous_xp_to_level)+" / "+(xp_to_level-previous_xp_to_level));$("#xpbar, #xpbar_status").hoverIntent({interval:200,
timeout:1E3});$("#xpbar, #xpbar_status").hoverIntent(function(){$("#xpbar_status").delay(200).show()},function(){$("#xpbar_status").delay(1E3).fadeOut()});var a=window.screen.availHeight;$("#mid_cont").height(a/2+a/9);$(".inner").hide();$("#slidebottom div").click(function(){get_details_notification();$(this).next().slideToggle()});""!=idu&&"addMeme"!=chc&&(setInterval("popup_expbar()",6E3),setInterval("live_ranking()",11E3))});
function log_in_reminder(){$.post("##LBL_SITE_URL##user/log_in_reminder",{ce:0},function(a){$.fancybox(a)})}function getall_notification(){$.post("##LBL_SITE_URL##manage/getall_notification",{ce:0},function(a){"-1"!=a[0]&&(0==a[2]?$(".not_txt").hide():$(".not_txt").show(),$("#user_ids").val(a[0]),$("#id_badges").val(a[1]),$("#not_cnt").html(a[2]))},"json")}
function get_details_notification(){$.post("##LBL_SITE_URL##/manage/get_details_notification",{id_users:$("#user_ids").val(),id_badges:$("#id_badges").val(),ce:0},function(a){$(".inner").html(a);$(".not_txt").hide()})}
function live_ranking(){var a,b=new XMLHttpRequest;b.open("POST","##LBL_SITE_URL##user/live_ranking/ce/0/chk/1",!1);b.send();200==b.status&&(a=b.responseText);console.log(a);if("no update"==a.trim()||"no rank"==a.trim())return!1;a=a.split(",");"AAB"==a[0].trim()?(console.log("Trailing User XP changed"),$("#trailing_exp").html(a[1]+'<span style="font-size:8px; position:relative; bottom:3px;"> XP</span>'),$("#other_user_ranking_info").css("background","#AAF2DC"),$("#other_user_ranking_info").animate({opacity:0.4},
700,function(){$("#other_user_ranking_info").css("background","#aad450");$("#other_user_ranking_info").animate({opacity:1},300)})):"AB"==a[0].trim()?(console.log("Trailing User changed"),$("#trailing_user").html(a[2]),$("#trailing_exp").html(a[1]+'<span style="font-size:8px; position:relative; bottom:3px;"> XP</span>')):"BA"==a[0].trim()?(console.log("Improvement in Rank"),new_rank=a[1],trailing_xp=a[2],trailing_user=a[3],trailing_rank=a[4],$("#ranking_number").html(new_rank),$("#user_ranking_info").css("background",
"#B9FE4E"),$("#user_ranking_info").animate({opacity:0.4},700,function(){$("#user_ranking_info").css("background","#4ebaff");$("#user_ranking_info").animate({opacity:1},300)}),trailing_user&&($("#trailing_ranking_number").html(trailing_rank),$("#trailing_exp").html(trailing_xp+'<span style="font-size:8px; position:relative; bottom:3px;"> XP</span>'),$("#trailing_user").html(trailing_user),$("#other_user_ranking_info").css("background","#FE4EB9"),$("#other_user_ranking_info").animate({opacity:0.4},
700,function(){$("#other_user_ranking_info").css("background","#aad450");$("#other_user_ranking_info").animate({opacity:1},300)}))):(console.log("Loss in rank"),new_rank=a[1],trailing_xp=a[2],trailing_user=a[3],trailing_rank=a[4],$("#ranking_number").html(new_rank),$("#user_ranking_info").css("background","#FE4EB9"),$("#user_ranking_info").animate({opacity:0.4},700,function(){$("#user_ranking_info").css("background","#4ebaff");$("#user_ranking_info").animate({opacity:1},300)}),trailing_user&&($("#trailing_ranking_number").html(trailing_rank),
$("#trailing_exp").html(trailing_xp+'<span style="font-size:8px; position:relative; bottom:3px;"> XP</span>'),$("#trailing_user").html(trailing_user),$("#other_user_ranking_info").css("background","#B9FE4E"),$("#other_user_ranking_info").animate({opacity:0.4},700,function(){$("#other_user_ranking_info").css("background","#aad450");$("#other_user_ranking_info").animate({opacity:1},300)})))}
function popup_expbar(){var a,b=new XMLHttpRequest;b.open("POST","##LBL_SITE_URL##user/getExperience/ce/0/chk/1",!1);b.send();200==b.status&&(a=b.responseText);if(90999999999==a)return!1;-1==a.indexOf(",")?(console.log("user has not levelled"),a=a.split("~"),new_xp=a[0],previous_xp_to_level=a[1],user_level=a[2],console.log("User Level is "+user_level),console.log("Previous XP to Level is "+previous_xp_to_level),console.log("XP_TO_LEVEL is "+xp_to_level),1==user_level?new_xp_percent=100*(new_xp/xp_to_level):
(console.log("New Total XP is "+new_xp),console.log("Previous XP to Level is "+previous_xp_to_level),new_xp_percent=100*((new_xp-previous_xp_to_level)/(xp_to_level-previous_xp_to_level)))):(console.log("user has levelled"),a=a.split(","),new_xp=a[0],new_level=a[1],$("#user_level").html("L"+new_level),$("#left_pan_level").html("L"+new_level),new_xp_to_level=a[2],previous_xp_to_level=xp_to_level,calc_new_xp_percent=new_xp-parseInt(previous_xp_to_level),new_xp_percent=100*(calc_new_xp_percent/(new_xp_to_level-
previous_xp_to_level)),xp_to_level=new_xp_to_level,$("#left_pan_level").css("background","#B9FE4E"),$("#left_pan_level").animate({opacity:0.4},500,function(){$("#left_pan_level").css("background","white");$("#left_pan_level").animate({opacity:1},300)}));$("#xpbar").progressbar({value:new_xp_percent});$("#xpbar_status").html("("+new_xp_percent.toFixed(2)+"%) "+(new_xp-previous_xp_to_level)+" / "+(xp_to_level-previous_xp_to_level));$("#xpbar_status").show();setTimeout('$("#xpbar_status").fadeOut();',
2E3);$("#total_xp").html(new_xp+'<span style="font-size:8px; position:relative; bottom:5px;"> XP</span>');$("#user_ranking_info").css("background","#4EFEEB");$("#user_ranking_info").animate({opacity:0.4},400,function(){$("#user_ranking_info").css("background","#4ebaff");$("#user_ranking_info").animate({opacity:1},300)})}function upd_log_time(){$.post("##LBL_SITE_URL##index.php",{page:"user",choice:"set_login_time",ce:0},function(){});setTimeout("upd_log_time()",1E4)}
function get_next_page(a,b,d,c){document.getElementById(c)||(c="content");$("#"+c).load(a,{qstart:b,limit:d,ce:0,pg:1,chk:1},function(){})}function show_fancybox(a){$.fancybox(a,{centerOnScroll:!0,hideOnOverlayClick:!1})}
$(function(){$(".leftpan_img").click(function(){$("#leftpan").toggle();$("#leftpan").is(":hidden")?$(".leftpan_img").css("background","url(##LBL_SITE_URL##templates/images/m_next_btn.png) no-repeat"):$(".leftpan_img").css("background","url(##LBL_SITE_URL##templates/images/m_previous_btn.png) no-repeat")});$(".rightpan_img").click(function(){$("#rightpan").toggle();$("#rightpan").is(":hidden")?$(".rightpan_img").css("background","url(##LBL_SITE_URL##templates/images/m_previous_btn.png) no-repeat"):
$(".rightpan_img").css("background","url(##LBL_SITE_URL##templates/images/m_next_btn.png) no-repeat")})});
	
</script>
<script type="text/javascript">
	    function fb_logout(){
	       url="##LBL_SITE_URL##";
	       $.post(url,{page:"user",choice:"check_fb_session",ce:0},function(res){
		if(res=='-1'){
		       window.location.href = url+"user/logout";
		} else {
				// First try logging out normal user
				window.location.href = url+"user/logout";
				
				// Then try FB logout
				if (idu) {
		       		FB.logout(function(response) {
						window.location.href = url+"user/logout";
		       		});
		       	}
		}

	       })
		}
	
</script>
{/literal}
</head>
<body>
<div id="fb-root"></div>
      {literal}
      <script>
        window.fbAsyncInit = function() {
          FB.init({
            appId      : '219049284838691',
            status     : true, 
            cookie     : true,
            xfbml      : true,
            oauth      : true,
          });
          
          FB.Event.subscribe('auth.login', function (response) {
          	console.log("FB.event.subscribe auth login fired");
          	window.location = "##LBL_SITE_URL##user/facebook_info";
    	  });
        };
        
        
        (function(d){
           var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
           js = d.createElement('script'); js.id = id; js.async = true;
           js.src = "//connect.facebook.net/en_US/all.js";
           d.getElementsByTagName('head')[0].appendChild(js);
         }(document))
      </script>       
{/literal}

  <input type="hidden" id="tst" value="2">
    <div id="mainpage">
		<div id="mymodal"></div>
	    	{include file='common/header'}

	    	{include file='common/menu'}

		{if $smarty.session.id_user && $smarty.request.choice !='addMeme'}
	    	<div class="leftpan_img"></div>
	    	<div class="rightpan_img"></div>
		{/if}

		<!-- Left/Center/Right Content -->
		<table width="100%" id="mid_cont">
		    <tr>
			{if $smarty.request.choice !='addMeme'}
			<td width="15%" id="leftpan" valign="top">
			    {if $smarty.session.id_user}	
				    {include file="user/left_pan"}
				{else} 
				    {include file=user/login_form"}
			    {/if}
			</td>
			{/if}

			<td align="left" valign="top">
			    <div><font color="#FF0000">{myinclude file="common/messages" module="global"}</font></div>
			    <div id="container">
				{if $smarty.request.choice !='addMeme'}
				
				</div>
				{/if}
				{if $smarty.session.id_user && $smarty.request.choice !='answer_to_ques' && $smarty.request.choice !='addMeme' && $smarty.request.choice !='meme_details'}
				    {get_mod mod=question mgr=question choice=get_this_week_question}<br>
				{/if}

		<!-- Content in middle of page (Live Feed/Editor) -->
				{include file=$content}

		<!-- Login form if user not logged in -->
			<!-- switched from user/login_form -->
				{if !$smarty.session.id_user && !$smarty.request.page}{include file="meme/home"}{/if} 
				</div>
			</td>

			{if $smarty.request.choice !='addMeme'}
			<td width="15%" id="rightpan" align="center" valign="top" >
			    {if $smarty.session.id_user}	
				    {include file="user/right_pan"}
			    {else}
			    
			    	<!-- Only shows Search meme w/o login -->
				    {include file="user/right_pan"}
			    {/if}
			</td>
			{/if}
		    </tr>
		</table>
		<div class="clear"></div>
		<div class="push"></div>
		<input type="hidden" id="user_ids" value=""/>
		<input type="hidden" id="id_badges" />
	</div>
	<div id="footer">Copyrights. All Rights Reserved. 2012 </div>
</body>
</html>

